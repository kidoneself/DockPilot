# DockPilot 容器模板系统开发任务清单

## 📋 总体进度
- **总任务数**: 156个
- **已完成**: 0个
- **进行中**: 0个
- **待开始**: 156个

---

## 🏗️ Phase 1: 基础架构 (Week 1)

### 📦 1.1 后端包结构创建
- [ ] 创建 `com.dockpilot.model.template` 包
- [ ] 创建 `com.dockpilot.service.template` 包
- [ ] 创建 `com.dockpilot.controller.template` 包
- [ ] 创建 `com.dockpilot.mapper.template` 包
- [ ] 创建 `com.dockpilot.storage` 包
- [ ] 创建 `com.dockpilot.utils.template` 包

### 📊 1.2 数据模型设计
- [ ] 创建 `ComposeTemplate.java` 实体类
- [ ] 添加 `@Table` 和 `@Column` 注解
- [ ] 创建 `TemplateType` 枚举类
- [ ] 创建 `SaveTemplateRequest.java` 请求类
- [ ] 创建 `ImportTemplateRequest.java` 请求类
- [ ] 创建 `DeployTemplateRequest.java` 请求类
- [ ] 创建 `TemplateListVO.java` 响应类
- [ ] 创建 `TemplateDetailVO.java` 响应类
- [ ] 创建 `TemplateShareVO.java` 响应类
- [ ] 创建 `ImageCheckResult.java` 镜像检查结果类

### 🗄️ 1.3 数据库设计
- [ ] 编写 `create_compose_templates.sql` 脚本
- [ ] 添加主键和外键约束
- [ ] 创建文件hash唯一索引
- [ ] 创建type和category复合索引
- [ ] 编写 `init_official_templates.sql` 脚本
- [ ] 测试数据库脚本执行

### 📁 1.4 文件存储系统
- [ ] 创建 `LocalTemplateStorage.java` 类
- [ ] 实现 `saveTemplateFile()` 方法
- [ ] 实现 `readTemplateFile()` 方法
- [ ] 实现 `deleteTemplateFile()` 方法
- [ ] 实现 `listTemplateFiles()` 方法
- [ ] 添加文件路径工具方法
- [ ] 实现文件哈希计算
- [ ] 添加文件备份机制
- [ ] 创建目录结构初始化方法
- [ ] 添加异常处理

### 🔧 1.5 ComposeGenerator重构
- [ ] 备份原有 `ComposeGenerator.java`
- [ ] 重新设计 `generateComposeContent()` 方法
- [ ] 优化 x-meta 结构生成
- [ ] 改进环境变量提取逻辑
- [ ] 添加路径环境变量化处理
- [ ] 实现服务配置转换
- [ ] 添加网络配置处理
- [ ] 实现卷挂载配置
- [ ] 添加端口映射处理
- [ ] 完善YAML格式化输出

### 🌐 1.6 API接口设计

#### 🏗️ 技术架构选择
- **HTTP RESTful API**: 模板管理操作(保存、导入、列表、分享、删除)
- **WebSocket**: 部署操作(实时进度、日志、控制)
- **理由**: 混合架构，简单操作用HTTP，复杂实时操作用WebSocket

#### 📝 HTTP API接口
- [ ] 创建 `TemplateController.java`
- [ ] 添加 `@RestController` 和 `@RequestMapping`
- [ ] 实现 `POST /api/templates/save` 接口
- [ ] 实现 `POST /api/templates/import` 接口
- [ ] 实现 `GET /api/templates` 接口
- [ ] 实现 `GET /api/templates/{id}` 接口
- [ ] 实现 `GET /api/templates/{id}/share` 接口
- [ ] 实现 `DELETE /api/templates/{id}` 接口
- [ ] 实现 `GET /api/templates/{id}/images/check` 接口
- [ ] 添加参数验证注解
- [ ] 添加异常处理
- [ ] 编写API文档注释

#### 🔌 WebSocket消息处理
- [ ] 在现有WebSocket系统中添加模板部署消息类型
- [ ] 实现 `TEMPLATE_DEPLOY` 消息处理
- [ ] 添加部署进度推送机制
- [ ] 实现部署日志实时输出
- [ ] 添加部署控制消息(取消、重试)

---

## 💾 Phase 2: 保存功能 (Week 2)

### 🔨 2.1 后端保存服务
- [ ] 创建 `ComposeTemplateService.java` 接口
- [ ] 创建 `ComposeTemplateServiceImpl.java` 实现类
- [ ] 实现 `saveTemplate()` 方法
- [ ] 实现容器信息获取逻辑
- [ ] 实现 Compose 内容生成
- [ ] 添加元数据提取逻辑
- [ ] 实现文件保存和数据库存储
- [ ] 添加重复检查逻辑
- [ ] 实现模板预览功能
- [ ] 添加保存事务处理

### 🗃️ 2.2 数据访问层
- [ ] 创建 `ComposeTemplateMapper.java` 接口
- [ ] 实现 `insert()` 方法
- [ ] 实现 `selectById()` 方法
- [ ] 实现 `selectByType()` 方法
- [ ] 实现 `selectByCategory()` 方法
- [ ] 实现 `updateUsageCount()` 方法
- [ ] 实现 `deleteById()` 方法
- [ ] 实现 `findByFileHash()` 方法
- [ ] 实现 `searchByKeyword()` 方法
- [ ] 编写对应的 XML 映射文件

### 🎨 2.1 主页设计
- [√] **改造现有应用中心为模板库页面**
- [√] **添加网格/列表视图模式切换**
- [√] **实现分类、类型筛选 (已去掉状态筛选)**
- [√] **设计模板卡片组件**
- [√] **添加部署、分享、删除等操作按钮**
- [√] **集成搜索功能**
- [√] **使用假数据展示效果**

### 🎨 2.3 前端容器列表增强
- [ ] 备份原有 `ContainerList.vue`
- [ ] 添加容器多选功能
- [ ] 创建 `ContainerSelector.vue` 组件
- [ ] 添加批量选择状态管理
- [ ] 实现全选/反选功能
- [ ] 添加已选容器计数显示
- [ ] 创建批量操作工具栏
- [ ] 添加"保存为模板"按钮
- [ ] 实现选择验证逻辑
- [ ] 优化界面布局

### 📝 2.4 保存模板弹窗
- [ ] 创建 `SaveTemplateModal.vue` 组件
- [ ] 设计表单字段布局
- [ ] 添加模板名称输入框
- [ ] 添加描述文本域
- [ ] 添加分类选择下拉框
- [ ] 实现表单验证规则
- [ ] 添加实时预览功能
- [ ] 创建 `TemplatePreview.vue` 组件
- [ ] 实现YAML代码高亮显示
- [ ] 在预览中显示包含的镜像列表
- [ ] 添加保存确认逻辑

### 📚 2.5 模板库主页
- [ ] 创建 `TemplateLibrary.vue` 页面
- [ ] 设计页面整体布局
- [ ] 添加Tab切换组件
- [ ] 创建搜索栏组件
- [ ] 添加分类筛选器
- [ ] 实现模板卡片网格布局
- [ ] 创建 `TemplateCard.vue` 组件
- [ ] 添加模板基本信息显示
- [ ] 实现使用次数统计
- [ ] 添加操作按钮组

### 🔍 2.6 搜索和筛选
- [ ] 实现关键词搜索功能
- [ ] 添加搜索结果高亮
- [ ] 实现分类筛选逻辑
- [ ] 添加时间排序功能
- [ ] 实现使用次数排序
- [ ] 添加清空筛选功能
- [ ] 实现搜索历史记录
- [ ] 优化搜索性能
- [ ] 添加搜索结果分页
- [ ] 实现无结果状态显示

---

## 📤 Phase 3: 分享导入 (Week 3)

### 📤 3.1 分享功能后端
- [ ] 实现 `shareTemplate()` 方法
- [ ] 添加内容脱敏逻辑
- [ ] 实现密码占位符替换
- [ ] 添加路径标准化处理
- [ ] 实现分享内容格式化
- [ ] 添加分享链接生成
- [ ] 实现分享统计功能
- [ ] 添加分享权限控制
- [ ] 实现分享日志记录
- [ ] 添加分享内容验证

### 🎨 3.2 分享界面设计
- [ ] 创建 `ShareTemplateModal.vue` 组件
- [ ] 设计分享弹窗布局
- [ ] 添加YAML内容展示区域
- [ ] 实现一键复制功能
- [ ] 添加复制成功提示
- [ ] 创建分享方式选择
- [ ] 实现文件下载功能
- [ ] 添加分享说明文档
- [ ] 实现分享码生成
- [ ] 添加分享状态反馈

### 📥 3.3 导入功能后端
- [ ] 实现 `importTemplate()` 方法
- [ ] 添加YAML格式验证
- [ ] 实现 x-meta 解析
- [ ] 添加模板信息提取
- [ ] 实现重复模板检查
- [ ] 添加端口冲突检测
- [ ] 实现环境变量分析
- [ ] 添加导入预检查
- [ ] 实现导入确认流程
- [ ] 添加导入错误处理

### 📝 3.4 导入页面设计
- [ ] 创建 `TemplateImport.vue` 页面
- [ ] 设计页面整体布局
- [ ] 添加YAML编辑器组件
- [ ] 实现语法高亮功能
- [ ] 添加实时格式验证
- [ ] 创建验证结果显示
- [ ] 实现错误提示组件
- [ ] 添加粘贴快捷功能
- [ ] 实现文件拖拽导入
- [ ] 添加导入预览功能
- [ ] 在导入预览中显示包含的镜像列表

### ⚠️ 3.5 冲突检查系统
- [ ] 创建 `ConflictChecker.java` 类
- [ ] 实现端口冲突检查
- [ ] 添加容器名冲突检查
- [ ] 实现路径冲突检查
- [ ] 添加网络冲突检查
- [ ] 实现冲突解决建议
- [ ] 创建 `ConflictResolution.vue` 组件
- [ ] 添加冲突详情显示
- [ ] 实现自动修复建议
- [ ] 添加手动调整功能

### 🔧 3.6 环境变量调整
- [ ] 创建 `EnvVarEditor.vue` 组件
- [ ] 实现环境变量列表显示
- [ ] 添加变量值编辑功能
- [ ] 实现默认值还原
- [ ] 添加变量类型验证
- [ ] 实现批量修改功能
- [ ] 添加变量描述提示
- [ ] 实现预览功能
- [ ] 添加变量导出功能
- [ ] 实现变量模板保存

---

## 🚀 Phase 4: 部署功能 (Week 4)

> **📋 镜像处理方案说明**  
> 采用简化的前端控制方案：
> - ✅ 部署前检查模板包含的镜像列表
> - ✅ 用户可单独拉取每个镜像（复用现有WebSocket拉取功能）
> - ✅ 支持批量拉取（依次执行，避免并发冲突）  
> - ✅ 拉取失败可重试，可跳过检查直接部署
> - ❌ 不实现暂停/取消功能，保持简单实用

### ⚙️ 4.1 部署服务后端
- [ ] 创建 `ContainerDeployService.java` 类
- [ ] 实现 `deployTemplate()` 方法
- [ ] 添加 Compose 解析逻辑
- [ ] 实现服务拆解功能
- [ ] 实现 `checkTemplateImages()` 方法 - 提取模板中的镜像列表
- [ ] 集成现有 `ImageService` 检查镜像存在性
- [ ] 实现镜像状态汇总（存在/缺失/拉取中）
- [ ] 添加 `GET /api/templates/{id}/images/check` 接口
- [ ] 添加容器创建队列
- [ ] 实现部署进度追踪
- [ ] 添加并发部署控制
- [ ] 实现部署事务管理
- [ ] 添加部署日志记录
- [ ] 实现部署状态管理

### 🔄 4.2 Compose解析器
- [ ] 创建 `ComposeParser.java` 类
- [ ] 实现 YAML 解析功能
- [ ] 添加 x-meta 信息提取
- [ ] 实现镜像列表提取功能
- [ ] 实现环境变量替换
- [ ] 添加服务依赖分析
- [ ] 实现网络配置解析
- [ ] 添加卷配置解析
- [ ] 实现端口配置解析
- [ ] 添加启动顺序计算
- [ ] 实现配置验证功能

### 🐳 4.3 容器部署逻辑
- [ ] 创建 `ContainerCreator.java` 类
- [ ] 实现 Docker 命令生成
- [ ] 添加镜像拉取逻辑
- [ ] 实现容器创建流程
- [ ] 添加容器启动逻辑
- [ ] 实现健康检查功能
- [ ] 添加启动失败处理
- [ ] 实现依赖等待机制
- [ ] 添加启动超时控制
- [ ] 实现启动状态反馈

### 📊 4.4 部署进度管理
- [ ] 创建 `DeployProgress.java` 类
- [ ] 实现进度状态枚举
- [ ] 添加进度百分比计算
- [ ] 实现任务队列管理
- [ ] 添加 WebSocket 消息推送
- [ ] 实现进度持久化
- [ ] 添加进度查询接口
- [ ] 实现进度重置功能
- [ ] 添加进度异常处理
- [ ] 实现进度统计功能

### 🎨 4.5 部署界面设计
- [ ] 创建 `DeployProgress.vue` 组件
- [ ] 设计进度条布局
- [ ] 添加步骤指示器
- [ ] 创建 `ImageCheckWizard.vue` 镜像检查向导组件
- [ ] 实现镜像状态列表显示（已存在/需拉取/拉取中/成功/失败）
- [ ] 添加单个镜像拉取按钮和进度显示
- [ ] 实现批量拉取功能（依次执行，避免并发）
- [ ] 添加拉取失败重试功能
- [ ] 集成现有 WebSocket 镜像拉取进度
- [ ] 实现跳过检查直接部署选项
- [ ] 实现实时日志显示
- [ ] 添加进度动画效果
- [ ] 创建状态图标组件
- [ ] 实现全屏显示模式
- [ ] 添加部署结果总结

### 🔙 4.6 回滚机制
- [ ] 创建 `DeployRollback.java` 类
- [ ] 实现部署前快照
- [ ] 添加回滚点创建
- [ ] 实现容器回滚逻辑
- [ ] 添加网络回滚功能
- [ ] 实现卷回滚处理
- [ ] 添加配置回滚功能
- [ ] 实现自动回滚触发
- [ ] 添加手动回滚功能
- [ ] 实现回滚状态验证

---

## ✨ Phase 5: 完善优化 (Week 5)

### 📚 5.1 官方模板制作
- [ ] 设计 LNMP 开发环境模板
- [ ] 创建 SpringBoot+MySQL 模板
- [ ] 制作 WordPress 博客模板
- [ ] 设计 Redis+MySQL 数据库组合
- [ ] 创建 Nginx 代理服务模板
- [ ] 制作 Node.js+MongoDB 模板
- [ ] 设计监控套装模板 (Prometheus+Grafana)
- [ ] 创建日志系统模板 (ELK)
- [ ] 制作个人网盘模板 (NextCloud)
- [ ] 设计在线代码编辑器模板

### 📖 5.2 模板文档编写
- [ ] 编写模板使用说明
- [ ] 添加环境变量说明
- [ ] 创建部署前置条件
- [ ] 编写常见问题解答
- [ ] 添加模板更新日志
- [ ] 创建模板最佳实践
- [ ] 编写故障排除指南
- [ ] 添加性能优化建议
- [ ] 创建安全配置指南
- [ ] 编写模板定制指南

### 🎨 5.3 图标和界面优化
- [ ] 设计模板分类图标
- [ ] 创建官方模板图标
- [ ] 添加状态指示图标
- [ ] 优化按钮样式设计
- [ ] 改进色彩搭配方案
- [ ] 添加暗色主题支持
- [ ] 优化响应式布局
- [ ] 改进加载动画效果
- [ ] 添加操作反馈动画
- [ ] 优化错误提示样式

### 📊 5.4 统计和分析
- [ ] 实现模板使用统计
- [ ] 添加部署成功率统计
- [ ] 创建用户操作统计
- [ ] 实现错误日志分析
- [ ] 添加性能监控指标
- [ ] 创建使用趋势图表
- [ ] 实现热门模板排行
- [ ] 添加系统健康检查
- [ ] 创建统计报表功能
- [ ] 实现数据导出功能

### 🔧 5.5 功能完善
- [ ] 实现模板版本管理
- [ ] 添加模板标签功能
- [ ] 创建模板收藏功能
- [ ] 实现模板评分系统
- [ ] 添加模板评论功能
- [ ] 创建模板推荐算法
- [ ] 实现批量操作功能
- [ ] 添加操作历史记录
- [ ] 创建快捷操作菜单
- [ ] 实现键盘快捷键

### 🧪 5.6 测试和质量保证
- [ ] 编写单元测试 - Service层
- [ ] 编写单元测试 - Controller层
- [ ] 编写单元测试 - Utils层
- [ ] 创建集成测试用例
- [ ] 实现端到端测试
- [ ] 添加性能压力测试
- [ ] 创建兼容性测试
- [ ] 实现自动化测试流程
- [ ] 添加代码覆盖率检查
- [ ] 进行安全性测试

---

## 📚 附加任务

### 📖 文档编写
- [ ] 编写 API 接口文档
- [ ] 创建用户使用手册
- [ ] 编写开发者文档
- [ ] 创建部署运维文档
- [ ] 编写故障排除指南
- [ ] 创建最佳实践文档

### 🎥 演示材料
- [ ] 录制功能演示视频
- [ ] 创建操作截图集合
- [ ] 制作产品介绍PPT
- [ ] 编写发布说明文档
- [ ] 创建用户反馈收集表
- [ ] 制作宣传推广材料

---

## 📈 进度跟踪

### Week 1 目标
- [ ] 完成 Phase 1 所有任务 (35个任务)
- [ ] 基础架构可用，API可调用

### Week 2 目标  
- [ ] 完成 Phase 2 所有任务 (31个任务)
- [ ] 容器保存功能完整可用

### Week 3 目标
- [ ] 完成 Phase 3 所有任务 (30个任务)  
- [ ] 分享导入功能完整可用

### Week 4 目标
- [ ] 完成 Phase 4 所有任务 (30个任务)
- [ ] 部署功能完整可用

### Week 5 目标
- [ ] 完成 Phase 5 所有任务 (30个任务)
- [ ] 系统完善，可正式发布

---

## 🏆 验收清单

### 功能验收
- [ ] 可以选择容器保存为模板
- [ ] 可以在模板库浏览管理模板
- [ ] 可以分享模板给朋友  
- [ ] 可以导入朋友分享的模板
- [ ] 可以部署模板为独立容器
- [ ] 所有核心流程无阻断错误

### 性能验收
- [ ] 模板保存响应时间 < 3秒
- [ ] 模板导入响应时间 < 2秒
- [ ] 部署启动时间 < 30秒
- [ ] 界面操作响应时间 < 500ms

### 质量验收
- [ ] 单元测试覆盖率 > 80%
- [ ] 端到端测试全部通过
- [ ] 无严重安全漏洞
- [ ] 代码规范检查通过

---

**总计**: 156个详细任务
**预计工时**: 5周 (200小时)
**开发人员**: 1人
**优先级**: P0 (最高优先级) 