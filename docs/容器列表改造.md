# 容器列表改造任务清单

## 前端改造任务

### WebSocket 集成
[√] 全局 WebSocket 服务已实现（DockerWebSocketService）
[√] WebSocket 连接管理已实现
[√] WebSocket 消息处理机制已实现
[√] WebSocket 重连机制已实现
[√] WebSocket 心跳检测已实现

### 容器列表页面改造
[ ] 定义容器列表相关的 WebSocket 消息类型（复用 Container 和 ContainerDetail 接口）
[ ] 在容器列表页面集成 WebSocket 服务
[ ] 实现容器列表实时更新机制
[ ] 添加 WebSocket 连接状态显示
[ ] 优化容器列表刷新机制
[ ] 添加 WebSocket 错误处理机制

### 容器操作改造
[ ] 定义容器操作相关的 WebSocket 消息类型（复用 ContainerCreateParams 接口）
[ ] 改造容器启动操作为 WebSocket 消息
[ ] 改造容器停止操作为 WebSocket 消息
[ ] 改造容器重启操作为 WebSocket 消息
[ ] 实现操作状态实时反馈
[ ] 优化操作确认对话框

### 类型定义更新
[√] Container 接口可复用
[√] ContainerDetail 接口可复用
[√] ContainerCreateParams 接口可复用
[ ] 在 `@/types/api/container.d.ts` 中添加 WebSocket 消息类型
[ ] 在 `@/types/api/container.d.ts` 中添加 WebSocket 事件类型

### 清理旧代码
[ ] 删除 `@/api/container.ts` 中的 HTTP 请求方法
[ ] 删除 `@/pages/docker/containers/index.vue` 中的 HTTP 相关代码
[ ] 删除不再使用的 HTTP 相关类型定义
[ ] 更新相关组件的导入语句
[ ] 清理相关的测试代码

## 后端改造任务

### WebSocket 服务端实现
[√] WebSocket 配置类已实现
[√] WebSocket 处理器已实现
[√] WebSocket 会话管理已实现
[√] WebSocket 消息分发机制已实现

### 容器服务改造
[ ] 在 DockerMessageDispatcher 中添加容器列表消息处理器
[ ] 实现容器状态变更通知机制
[ ] 实现容器操作状态推送
[ ] 实现容器列表更新推送

### 数据模型更新
[√] ContainerDTO 可复用
[√] ContainerStaticInfoDTO 可复用
[√] ContainerCreateRequest 可复用
[ ] 在 DockerWebSocketMessage 中添加容器相关消息类型
[ ] 定义容器状态变更事件模型
[ ] 定义容器操作事件模型

### 安全性改造
[√] WebSocket 基础安全配置已实现
[ ] 实现 WebSocket 消息认证
[ ] 添加 WebSocket 访问控制
[ ] 实现 WebSocket 消息加密

### 清理旧代码
[ ] 删除 ContainerController 中的 HTTP 接口
[ ] 删除不再使用的 HTTP 相关服务方法
[ ] 删除不再使用的 HTTP 相关模型类
[ ] 更新相关的单元测试
[ ] 清理相关的文档注释

## 测试任务
[ ] 编写容器列表 WebSocket 消息测试
[ ] 编写容器操作 WebSocket 消息测试
[ ] 编写错误处理测试
[ ] 编写性能测试
[ ] 验证旧功能是否完全迁移

## 文档任务
[ ] 更新容器列表 WebSocket 使用说明
[ ] 更新 API 文档
[ ] 更新部署文档
[ ] 编写故障排除指南
[ ] 更新接口变更说明

## 部署任务
[ ] 更新环境变量配置
[ ] 配置 WebSocket 代理
[ ] 准备回滚方案
[ ] 准备数据迁移方案

## 注意事项
1. 使用现有的 `DockerWebSocketService` 进行消息收发
2. 在页面组件中正确使用 `onMounted` 和 `onUnmounted` 生命周期钩子
3. 确保消息处理函数的正确注册和注销
4. 遵循现有的 WebSocket 消息格式规范
5. 保持与通知中心的良好集成
6. 使用现有的 `DockerMessageDispatcher` 进行消息分发
7. 遵循现有的 `DockerWebSocketMessage` 消息格式
8. 在删除旧代码前确保新功能完全可用
9. 保留必要的代码注释和文档
10. 确保向后兼容性
11. 复用现有的数据模型和类型定义
12. 保持数据转换逻辑的一致性 